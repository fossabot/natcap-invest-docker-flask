#!/bin/bash
# starts/restarts our container
# You don't need the code locally, you can just deploy this script to a host with docker
#  and run it.
set euo -pipefail

name=natcap
hostPort=5000

# TODO change this to the Docker image tag you want to run
dockerTag=1.1.2_3.6.0

# uncomment the following for a production deploy
#theEnv=production
#restartPolicy=unless-stopped

existingContainerId=`docker ps -f name='^${name}$'`
if [ ! -z "$existingContainerId" ]; then
  echo "[INFO] killing existing container $existingContainerId"
  docker rm -f $name
fi

docker run \
  --detach \
  --name=$name \
  -p 5000:$hostPort \
  -e NIDF_ENV=${theEnv:-development} \
  --restart=${restartPolicy:-no} \
  ternandsparrow/natcap-invest-docker-flask:$dockerTag
